<div class="admin-pedidos-container">
  <h2>Listado de Pedidos</h2>

  <div *ngIf="isLoading">Cargando pedidos...</div>
  <div *ngIf="errorMensaje">{{ errorMensaje }}</div>

  <table *ngIf="!isLoading && !errorMensaje">
    <thead>
      <tr>
        <th>ID</th>
        <th>Fecha/Hora</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Dirección</th>
        <th>Teléfono</th>
        <th>Estado Pago</th>
        <th>Tipo Pago</th>
        <th>Total</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pedido of pedidos; trackBy: trackByPedidoId" [class.pendiente]="pedido.estado === 'PAGO_PENDIENTE'">
        <td>{{ pedido.Id || pedido.id }}</td>
        <td>{{ pedido.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
        <td>{{ pedido.nombre }}</td>
        <td>{{ pedido.correo }}</td>
        <td>{{ pedido.direccion }}</td>
        <td>{{ pedido.telefono }}</td>
        <td>{{ pedido.estado }}</td>
        <td>{{ pedido.tipoPago || 'N/A' }}</td>
        <td>{{ pedido.total | currency:'USD':'symbol':'1.2-2' }}</td>
        <td>
          <button 
            *ngIf="pedido.estado === 'PAGO_ENVIADO'"
            class="btn btn-primary"
            (click)="abrirModal(pedido)">
            Ver Voucher
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pedido-cards" *ngIf="!isLoading && !errorMensaje">
    <article class="pedido-card" *ngFor="let pedido of pedidos; trackBy: trackByPedidoId">
      <h3>Pedido #{{ pedido.Id || pedido.id }}</h3>
      <p><strong>Fecha:</strong> {{ pedido.fecha | date:'dd/MM/yyyy HH:mm' }}</p>
      <p><strong>Nombre:</strong> {{ pedido.nombre }}</p>
      <p><strong>Estado:</strong> {{ pedido.estado }}</p>
      <p><strong>Total:</strong> {{ pedido.total | currency:'USD':'symbol':'1.2-2' }}</p>
      <button
        *ngIf="pedido.estado === 'PAGO_ENVIADO'"
        class="btn btn-primary"
        (click)="abrirModal(pedido)">
        Ver Voucher
      </button>
    </article>
  </div>
</div>
<app-modal *ngIf="selectedPedido" [title]="'Voucher Pedido #' + (selectedPedido!.Id || selectedPedido!.id)" (close)="cerrarModal()">
  <img *ngIf="voucherImg" [src]="voucherImg" alt="Voucher" />
  <div modal-footer>
    <button class="btn btn-success" (click)="validarPago()" [disabled]="processing">Validar Pago</button>
    <button class="btn btn-danger" (click)="rechazarPago()" [disabled]="processing">Rechazar Pago</button>
  </div>
</app-modal>
